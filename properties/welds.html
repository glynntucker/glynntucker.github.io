<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>body {background-color: #b0b0b0;}</style>
    <title>Weld Properties</title>
  </head>
  <script src="../header.js"></script>
  <body style="font-family:arial;" align="center">
    <h3 align="Center">Weld Properties</h3>
    <p>Search weld capacities.</p>

    <div class="row">
      <div class="column">
        <h4 align="center">Category SP, &Phi;=0.8</h4>
        <table id="weldSp" align="center">
          <colgroup>
            <col span="1" width="60">
            <col span="1" width="76">
            <col span="1" width="103">
            <col span="1" width="103">
          </colgroup>
          <tr>
            <th colspan="2">Weld Size (mm)</th>
            <th colspan="2">Design Capacity (kN/mm)</th>
          </tr>
          <tr>
            <th>t<sub>w</sub> (leg)</th>
            <th>t<sub>t</sub> (throat)</th>
            <th>E41XX/W40X</th>
            <th>E48XX/W50X</th>
          </tr>
          <tbody id="weldSpBody"><tr><td colspan="4">Loading data...</td></tr></tbody>
        </table>
      </div>

      <div class="column">
        <h4 align="center">Category GP, &Phi;=0.6</h4>
        <table id="weldGp" align="center">
          <colgroup>
            <col span="1" width="60">
            <col span="1" width="76">
            <col span="1" width="103">
            <col span="1" width="103">
          </colgroup>
          <tr>
            <th colspan="2">Weld Size (mm)</th>
            <th colspan="2">Design Capacity (kN/mm)</th>
          </tr>
          <tr>
            <th>t<sub>w</sub> (leg)</th>
            <th>t<sub>t</sub> (throat)</th>
            <th>E41XX/W40X</th>
            <th>E48XX/W50X</th>
          </tr>
          <tbody id="weldGpBody"><tr><td colspan="4">Loading data...</td></tr></tbody>
        </table>
      </div>
    </div>

    <br>
    <br>
  </body>
</html>
<script src="../tables.js"></script>
<script>
  function parseSimpleCsv(text) {
    var lines = text.split(/\r?\n/).filter(function(line) { return line.trim() !== ""; });
    if (lines.length < 2) return [];
    var headers = lines[0].split(",");
    var rows = [];
    for (var i = 1; i < lines.length; i++) {
      var values = lines[i].split(",");
      if (values.length !== headers.length) continue;
      var row = {};
      for (var j = 0; j < headers.length; j++) row[headers[j].trim()] = values[j].trim();
      rows.push(row);
    }
    return rows;
  }

  function addCell(tr, value) {
    var td = document.createElement("td");
    td.innerText = value;
    tr.appendChild(td);
  }

  function renderWeldRows(rows, category, bodyId) {
    var tbody = document.getElementById(bodyId);
    tbody.innerHTML = "";
    var filtered = rows.filter(function(r) { return r.Category === category; });

    if (!filtered.length) {
      tbody.innerHTML = '<tr><td colspan="4">No data found.</td></tr>';
      return;
    }

    for (var i = 0; i < filtered.length; i++) {
      var tr = document.createElement("tr");
      tr.setAttribute("onclick", "changeColour(this)");
      addCell(tr, filtered[i].Leg);
      addCell(tr, filtered[i].Throat);
      addCell(tr, filtered[i].E41XX_W40X);
      addCell(tr, filtered[i].E48XX_W50X);
      tbody.appendChild(tr);
    }
  }

  (function loadWeldCsv() {
    fetch("./welds.csv", { cache: "no-store" })
      .then(function(res) { if (!res.ok) throw new Error("Failed to load welds.csv"); return res.text(); })
      .then(function(text) {
        var rows = parseSimpleCsv(text);
        renderWeldRows(rows, "SP", "weldSpBody");
        renderWeldRows(rows, "GP", "weldGpBody");
      })
      .catch(function() {
        document.getElementById("weldSpBody").innerHTML = '<tr><td colspan="4">Could not load CSV data.</td></tr>';
        document.getElementById("weldGpBody").innerHTML = '<tr><td colspan="4">Could not load CSV data.</td></tr>';
      });
  })();
</script>
