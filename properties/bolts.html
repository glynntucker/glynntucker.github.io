<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>body {background-color: #b0b0b0;}</style>
    <title>Bolt Properties</title>
  </head>
  <script src="../header.js"></script>
  <body style="font-family:arial;" align="center">
    <h3 align="Center">Bolt Properties</h3>
    <p>Search bolt grade and capacities.</p>

    <div class="row">
      <div class="columnouter"><h2></h2></div>
      <div class="column">
        <h4 align="center">4.6/S</h4>
        <table id="bolts46" align="center">
          <colgroup>
            <col span="1" width="100">
            <col span="1" width="65">
            <col span="2" width="62">
          </colgroup>
          <tr>
            <th rowspan="4">Designation</th>
            <th rowspan="2">Axial Tension</th>
            <th colspan="2">Shear Values</th>
          </tr>
          <tr>
            <th>Threads inc</th>
            <th>Threads exc</th>
          </tr>
          <tr>
            <th>&Phi;N<sub>tf</sub></th>
            <th>&Phi;V<sub>fn</sub></th>
            <th>&Phi;V<sub>fn</sub></th>
          </tr>
          <tr>
            <th>kN</th>
            <th>kN</th>
            <th>kN</th>
          </tr>
          <tbody id="bolts46Body"><tr><td colspan="4">Loading data...</td></tr></tbody>
        </table>
      </div>

      <div class="column">
        <h4 align="center">8.8/S, 8.8/TB, 8.8/TF</h4>
        <table id="bolts88" align="center">
          <colgroup>
            <col span="1" width="100">
            <col span="1" width="65">
            <col span="2" width="62">
          </colgroup>
          <tr>
            <th rowspan="4">Designation</th>
            <th rowspan="2">Axial Tension</th>
            <th colspan="2">Shear Values</th>
          </tr>
          <tr>
            <th>Threads inc</th>
            <th>Threads exc</th>
          </tr>
          <tr>
            <th>&Phi;N<sub>tf</sub></th>
            <th>&Phi;V<sub>fn</sub></th>
            <th>&Phi;V<sub>fn</sub></th>
          </tr>
          <tr>
            <th>kN</th>
            <th>kN</th>
            <th>kN</th>
          </tr>
          <tbody id="bolts88Body"><tr><td colspan="4">Loading data...</td></tr></tbody>
        </table>
      </div>
    </div>

    <h4 align="center">Minimum Edge Distance</h4>
    <table id="boltsEdge" align="center">
      <colgroup>
        <col span="1" width="100">
        <col span="1" width="100">
        <col span="1" width="100">
        <col span="1" width="100">
      </colgroup>
      <tr>
        <th>Nominal Diameter of Fastener</th>
        <th>Sheared or Hand Flame Cut Edge</th>
        <th>Rolled Plate: Machine Flame Cut, Sawn or Planed Edge</th>
        <th>Rolled Edge of a Rolled Flat Bar or Section</th>
      </tr>
      <tr>
        <th>mm</th>
        <th>mm</th>
        <th>mm</th>
        <th>mm</th>
      </tr>
      <tbody id="boltsEdgeBody"><tr><td colspan="4">Loading data...</td></tr></tbody>
    </table>

    <br>
    <br>
  </body>
</html>
<script src="../tables.js"></script>
<script>
  function parseSimpleCsv(text) {
    var lines = text.split(/\r?\n/).filter(function(line) { return line.trim() !== ""; });
    if (lines.length < 2) return [];
    var headers = lines[0].split(",");
    var rows = [];
    for (var i = 1; i < lines.length; i++) {
      var values = lines[i].split(",");
      if (values.length !== headers.length) continue;
      var row = {};
      for (var j = 0; j < headers.length; j++) row[headers[j].trim()] = values[j].trim();
      rows.push(row);
    }
    return rows;
  }

  function addCell(tr, value) {
    var td = document.createElement("td");
    td.innerText = value;
    tr.appendChild(td);
  }

  function renderBoltStrength(rows, grade, bodyId) {
    var tbody = document.getElementById(bodyId);
    tbody.innerHTML = "";
    var filtered = rows.filter(function(r) { return r.Grade === grade; });
    if (!filtered.length) {
      tbody.innerHTML = '<tr><td colspan="4">No data found.</td></tr>';
      return;
    }
    for (var i = 0; i < filtered.length; i++) {
      var tr = document.createElement("tr");
      tr.setAttribute("onclick", "changeColour(this)");
      addCell(tr, filtered[i].Designation);
      addCell(tr, filtered[i].AxialTension);
      addCell(tr, filtered[i].ShearThreadsInc);
      addCell(tr, filtered[i].ShearThreadsExc);
      tbody.appendChild(tr);
    }
  }

  function renderBoltEdge(rows) {
    var tbody = document.getElementById("boltsEdgeBody");
    tbody.innerHTML = "";
    if (!rows.length) {
      tbody.innerHTML = '<tr><td colspan="4">No data found.</td></tr>';
      return;
    }
    for (var i = 0; i < rows.length; i++) {
      var tr = document.createElement("tr");
      tr.setAttribute("onclick", "changeColour(this)");
      addCell(tr, rows[i].Diameter);
      addCell(tr, rows[i].ShearedOrHandFlameCutEdge);
      addCell(tr, rows[i].RolledPlateMachineFlameCutSawnOrPlanedEdge);
      addCell(tr, rows[i].RolledEdgeRolledFlatBarOrSection);
      tbody.appendChild(tr);
    }
  }

  (function loadBoltData() {
    Promise.all([
      fetch("./bolts_strength.csv", { cache: "no-store" }).then(function(res){ if(!res.ok) throw new Error(); return res.text(); }),
      fetch("./bolts_edge.csv", { cache: "no-store" }).then(function(res){ if(!res.ok) throw new Error(); return res.text(); })
    ])
    .then(function(results) {
      var strengthRows = parseSimpleCsv(results[0]);
      var edgeRows = parseSimpleCsv(results[1]);
      renderBoltStrength(strengthRows, "4.6/S", "bolts46Body");
      renderBoltStrength(strengthRows, "8.8_Group", "bolts88Body");
      renderBoltEdge(edgeRows);
    })
    .catch(function() {
      document.getElementById("bolts46Body").innerHTML = '<tr><td colspan="4">Could not load CSV data.</td></tr>';
      document.getElementById("bolts88Body").innerHTML = '<tr><td colspan="4">Could not load CSV data.</td></tr>';
      document.getElementById("boltsEdgeBody").innerHTML = '<tr><td colspan="4">Could not load CSV data.</td></tr>';
    });
  })();
</script>
