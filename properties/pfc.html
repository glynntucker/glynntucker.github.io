<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>body {background-color: #b0b0b0;}</style>
    <title>PFC Properties</title>
  </head>
  <script src="../header.js"></script>
  <body style="font-family:arial;" align="center">
    <h3 align="Center">PFC Properties</h3>
    <p>Search, sort or hover over a member to see its properties.</p>
    <div class="inputBox" align="middle">
      <input type="text" id="myInput" onkeyup="searchFunction()" placeholder="Search for a member" title="Type in a member">
    </div>

    <button class="button" onclick="sortSizeDown(6)">Decreasing Size</button>
    <button class="button" onclick="sortSizeUp(6)">Increasing Size</button>
    <button class="button" onclick="sortMassDown(5)">Decreasing Mass</button>
    <button class="button" onclick="sortMassUp(5)">Increasing Mass</button>
    <br>
    <br>

    <table id="myTable" align="center">
      <tr>
        <th rowspan="2">Member</th>
        <th>Depth</th>
        <th>Flange Width</th>
        <th>Flange Thickness</th>
        <th>Web Thickness</th>
        <th>Mass</th>
        <th>I<sub>xx</sub></th>
        <th>I<sub>yy</sub></th>
        <th>&Phi;M<sub>sx</sub></th>
        <th rowspan="2" class='rotateOrder'><div>Order</div></th>
      </tr>
      <tr>
        <th>mm</th>
        <th>mm</th>
        <th>mm</th>
        <th>mm</th>
        <th>kg/m</th>
        <th>10<sup>6</sup> mm<sup>4</sup></th>
        <th>10<sup>6</sup> mm<sup>4</sup></th>
        <th>kNm</th>
      </tr>
      <tbody id="pfcTableBody">
        <tr><td colspan="10">Loading PFC data...</td></tr>
      </tbody>
    </table>

    <br>
    <br>
  </body>
</html>
<script src="../tables.js"></script>
<script>
  function parseSimpleCsv(text) {
    var lines = text.split(/\r?\n/).filter(function(line) { return line.trim() !== ""; });
    if (lines.length < 2) return [];
    var headers = lines[0].split(",");
    var rows = [];
    for (var i = 1; i < lines.length; i++) {
      var values = lines[i].split(",");
      if (values.length !== headers.length) continue;
      var row = {};
      for (var j = 0; j < headers.length; j++) row[headers[j].trim()] = values[j].trim();
      rows.push(row);
    }
    return rows;
  }

  function addCell(tr, value) {
    var td = document.createElement("td");
    td.innerText = value;
    tr.appendChild(td);
  }

  function renderPfcRows(rows) {
    var tbody = document.getElementById("pfcTableBody");
    tbody.innerHTML = "";
    var keys = ["Member", "Depth", "FlangeWidth", "FlangeThickness", "WebThickness", "Mass", "Ixx", "Iyy", "PhiMsx", "Order"];

    if (!rows.length) {
      tbody.innerHTML = '<tr><td colspan="10">No PFC data found.</td></tr>';
      return;
    }

    for (var i = 0; i < rows.length; i++) {
      var tr = document.createElement("tr");
      tr.setAttribute("onclick", "changeColour(this)");
      for (var j = 0; j < keys.length; j++) addCell(tr, rows[i][keys[j]] || "");
      tbody.appendChild(tr);
    }
  }

  (function loadPfcCsv() {
    fetch("./pfc.csv", { cache: "no-store" })
      .then(function(res) { if (!res.ok) throw new Error("Failed to load pfc.csv"); return res.text(); })
      .then(function(text) { renderPfcRows(parseSimpleCsv(text)); })
      .catch(function() {
        document.getElementById("pfcTableBody").innerHTML = '<tr><td colspan="10">Could not load PFC CSV data.</td></tr>';
      });
  })();
</script>
